#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/mman.h>
#include <dlfcn.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/mman.h>
#include "libpoem.h"
#include "shuffle.h"

int func[][3]={{606,96816,56196},{641,96824,56212},{175,96832,56228},{1272,96840,56244},{1276,96848,56260},{286,96856,56276},{249,96864,56292},{502,96872,56308},{284,96880,56324},{208,96888,56340},{280,96896,56356},{541,96904,56372},{206,96912,56388},{786,96920,56404},{1237,96928,56420},{1008,96936,56436},{788,96944,56452},{704,96952,56468},{741,96960,56484},{1045,96968,56500},{1235,96976,56516},{738,96984,56532},{706,96992,56548},{1239,97000,56564},{1152,97008,56580},{849,97016,56596},{775,97024,56612},{1004,97032,56628},{1193,97040,56644},{1156,97048,56660},{771,97056,56676},{1191,97064,56692},{200,97072,56708},{380,97080,56724},{1309,97088,56740},{1136,97096,56756},{847,97104,56772},{877,97112,56788},{808,97120,56804},{57,97128,56820},{1132,97136,56836},{1134,97144,56852},{841,97152,56868},{1348,97160,56884},{1346,97168,56900},{10,97176,56916},{1291,97184,56932},{884,97192,56948},{1293,97200,56964},{1385,97208,56980},{300,97216,56996},{473,97224,57012},{1250,97232,57028},{304,97240,57044},{949,97248,57060},{1254,97256,57076},{1217,97264,57092},{1446,97272,57108},{1409,97280,57124},{1256,97288,57140},{947,97296,57156},{1219,97304,57172},{1407,97312,57188},{1215,97320,57204},{1448,97328,57220},{945,97336,57236},{908,97344,57252},{906,97352,57268},{943,97360,57284},{96,97368,57300},{986,97376,57316},{1213,97384,57332},{180,97392,57348},{1211,97400,57364},{141,97408,57380},{591,97416,57396},{558,97424,57412},{108,97432,57428},{519,97440,57444},{556,97448,57460},{432,97456,57476},{1186,97464,57492},{597,97472,57508},{147,97480,57524},{1149,97488,57540},{430,97496,57556},{92,97504,57572},{1147,97512,57588},{182,97520,57604},{145,97528,57620},{631,97536,57636},{1188,97544,57652},{149,97552,57668},{186,97560,57684},{1284,97568,57700},{684,97576,57716},{238,97584,57732},{680,97592,57748},{511,97600,57764},{273,97608,57780},{234,97616,57796},{102,97624,57812},{271,97632,57828},{550,97640,57844},{513,97648,57860},{799,97656,57876},{711,97664,57892},{1019,97672,57908},{1421,97680,57924},{28,97688,57940},{26,97696,57956},{782,97704,57972},{1184,97712,57988},{1015,97720,58004},{1011,97728,58020},{1013,97736,58036},{391,97744,58052},{317,97752,58068},{315,97760,58084},{230,97768,58100},{866,97776,58116},{1332,97784,58132},{834,97792,58148},{20,97800,58164},{22,97808,58180},{1082,97816,58196},{871,97824,58212},{873,97832,58228},{1260,97840,58244},{1379,97848,58260},{1338,97856,58276},{1221,97864,58292},{429,97872,58308},{466,97880,58324},{1084,97888,58340},{1373,97896,58356},{427,97904,58372},{313,97912,58388},{311,97920,58404},{1377,97928,58420},{1225,97936,58436},{921,97944,58452},{1418,97952,58468},{1451,97960,58484},{1049,97968,58500},{1414,97976,58516},{953,97984,58532},{1160,97992,58548},{990,98000,58564},{157,98008,58580},{568,98016,58596},{1457,98024,58612},{1121,98032,58628},{155,98040,58644},{566,98048,58660},{67,98056,58676},{153,98064,58692},{114,98072,58708},{529,98080,58724},{527,98088,58740},{112,98096,58756},{562,98104,58772},{460,98112,58788},{61,98120,58804},{421,98128,58820},{1175,98136,58836},{639,98144,58852},{676,98152,58868},{159,98160,58884},{620,98168,58900},{637,98176,58916},{674,98184,58932},{635,98192,58948},{624,98200,58964},{1313,98208,58980},{1179,98216,58996},{261,98224,59012},{226,98232,59028},{224,98248,59060},{1258,98256,59076},{758,98264,59092},{720,98272,59108},{1026,98280,59124},{523,98288,59140},{1067,98296,59156},{756,98304,59172},{265,98312,59188},{754,98320,59204},{719,98328,59220},{1063,98336,59236},{761,98344,59252},{717,98352,59268},{269,98360,59284},{797,98368,59300},{4,98376,59316},{328,98384,59332},{326,98392,59348},{222,98400,59364},{829,98408,59380},{898,98416,59396},{1114,98424,59412},{369,98432,59428},{220,98440,59444},{827,98448,59460},{367,98456,59476},{1321,98464,59492},{825,98472,59508},{851,98480,59524},{814,98488,59540},{2,98496,59556},{1360,98504,59572},{823,98512,59588},{33,98520,59604},{1093,98528,59620},{1232,98536,59636},{862,98544,59652},{864,98552,59668},{1362,98560,59684},{457,98568,59700},{1230,98576,59716},{1097,98584,59732},{860,98592,59748},{1095,98600,59764},{492,98608,59780},{418,98616,59796},{416,98624,59812},{451,98632,59828},{1056,98640,59844},{1423,98648,59860},{1368,98656,59876},{320,98664,59892},{1234,98672,59908},{929,98680,59924},{498,98688,59940},{1099,98696,59956},{927,98704,59972},{925,98712,59988},{1464,98720,60004},{1468,98728,60020},{129,98736,60036},{960,98744,60052},{1110,98752,60068},{164,98760,60084},{577,98768,60100},{76,98776,60116},{538,98784,60132},{575,98792,60148},{160,98800,60164},{573,98808,60180},{70,98816,60196},{412,98824,60212},{1306,98832,60228},{698,98840,60244},{651,98848,60260},{1125,98856,60276},{628,98864,60292},{663,98872,60308},{1300,98880,60324},{1129,98888,60340},{661,98896,60356},{1304,98904,60372},{299,98912,60388},{254,98920,60404},{1266,98928,60420},{1264,98936,60436},{534,98944,60452},{571,98952,60468},{769,98960,60484},{776,98968,60500},{1074,98976,60516},{293,98984,60532},{532,98992,60548},{1406,99000,60564},{291,99008,60580},{1268,99016,60596},{47,99024,60612},{1072,99032,60628},{728,99040,60644},{1035,99048,60660},{1229,99056,60676},{726,99064,60692},{6,99072,60708},{1166,99080,60724},{1400,99088,60740},{374,99096,60756},{339,99104,60772},{337,99112,60788},{801,99120,60804},{1144,99128,60820},{1107,99136,60836},{1356,99144,60852},{857,99152,60868},{1354,99160,60884},{1317,99168,60900},{45,99176,60916},{1142,99184,60932},{805,99192,60948},{1105,99200,60964},{855,99208,60980},{43,99216,60996},{853,99224,61012},{816,99232,61028},{894,99240,61044},{896,99248,61060},{1103,99256,61076},{892,99264,61092},{1391,99272,61108},{1101,99280,61124},{448,99288,61140},{446,99296,61156},{409,99304,61172},{1399,99312,61188},{407,99320,61204},{1434,99328,61220},{1069,99336,61236},{333,99344,61252},{1246,99352,61268},{1395,99368,61300},{331,99376,61316},{989,99384,61332},{901,99392,61348},{1471,99400,61364},{933,99408,61380},{903,99416,61396},{1242,99424,61412},{1203,99432,61428},{489,99440,61444},{1436,99448,61460},{1473,99456,61476},{974,99464,61492},{970,99472,61508},{1475,99480,61524},{583,99488,61540},{133,99496,61556},{548,99504,61572},{581,99512,61588},{546,99520,61604},{84,99528,61620},{1140,99536,61636},{509,99544,61652},{601,99552,61668},{139,99560,61684},{687,99568,61700},{440,99576,61716},{403,99584,61732},{1116,99592,61748},{659,99600,61764},{1331,99608,61780},{642,99616,61796},{607,99624,61812},{657,99632,61828},{176,99640,61844},{1273,99648,61860},{692,99656,61876},{285,99664,61892},{248,99672,61908},{1040,99688,61940},{283,99696,61956},{244,99704,61972},{501,99712,61988},{242,99720,62004},{739,99728,62020},{785,99736,62036},{505,99744,62052},{701,99752,62068},{287,99760,62084},{787,99768,62100},{1279,99776,62116},{58,99784,62132},{1007,99792,62148},{772,99800,62164},{1001,99808,62180},{1151,99816,62196},{50,99824,62212},{1192,99832,62228},{240,99840,62244},{203,99848,62260},{307,99856,62276},{15,99864,62292},{201,99872,62308},{876,99880,62324},{1194,99888,62340},{1345,99896,62356},{1137,99904,62372},{56,99912,62388},{1308,99920,62404},{1133,99928,62420},{1347,99936,62436},{807,99944,62452},{842,99952,62468},{885,99960,62484},{1198,99968,62500},{1388,99976,62516},{1380,99984,62532},{439,99992,62548},{437,100000,62564},{470,100008,62580},{433,100016,62596},{1445,100024,62612},{340,100032,62628},{1255,100040,62644},{1218,100048,62660},{1386,100056,62676},{956,100064,62692},{946,100072,62708},{993,100080,62724},{1212,100088,62740},{944,100096,62756},{995,100104,62772},{97,100112,62788},{1251,100120,62804},{1253,100128,62820},{983,100136,62836},{95,100144,62852},{985,100152,62868},{144,100160,62884},{981,100168,62900},{142,100176,62916},{109,100184,62932},{590,100192,62948},{557,100200,62964},{518,100208,62980},{598,100216,62996},{185,100224,63012},{1148,100232,63028},{630,100240,63044},{183,100248,63060},{648,100256,63076},{632,100264,63092},{189,100272,63108},{634,100280,63124},{646,100288,63140},{1189,100296,63156},{1090,100304,63172},{609,100312,63188},{683,100320,63204},{685,100328,63220},{1283,100336,63236},{1051,100344,63252},{235,100352,63268},{512,100360,63284},{272,100368,63300},{1285,100376,63316},{101,100384,63332},{551,100392,63348},{710,100400,63364},{748,100408,63380},{278,100416,63396},{239,100424,63412},{712,100432,63428},{709,100440,63444},{1287,100448,63460},{25,100456,63476},{744,100464,63492},{707,100472,63508},{1016,100480,63524},{1185,100488,63540},{1012,100496,63556},{783,100504,63572},{396,100512,63588},{318,100520,63604},{355,100528,63620},{27,100536,63636},{1333,100544,63652},{23,100552,63668},{1337,100560,63684},{822,100568,63700},{1370,100576,63716},{1335,100584,63732},{872,100592,63748},{1374,100600,63764},{1085,100608,63780},{870,100616,63796},{469,100624,63812},{467,100632,63828},{351,100640,63844},{919,100648,63860},{1413,100656,63876},{920,100664,63892},{1450,100672,63908},{969,100680,63924},{1415,100688,63940},{999,100696,63956},{952,100704,63972},{954,100712,63988},{117,100720,64004},{567,100728,64020},{1120,100736,64036},{154,100744,64052},{950,100752,64068},{115,100760,64084},{1454,100768,64100},{1419,100776,64116},{152,100784,64132},{528,100792,64148},{563,100800,64164},{113,100808,64180},{111,100816,64196},{561,100824,64212},{62,100832,64228},{424,100840,64244},{461,100848,64260},{1351,100856,64276},{621,100864,64292},{677,100872,64308},{158,100880,64324},{1316,100888,64340},{1353,100896,64356},{569,100904,64372},{660,100912,64388},{199,100920,64404},{1312,100928,64420},{636,100936,64436},{1176,100944,64452},{1310,100952,64468},{262,100960,64484},{520,100968,64500},{260,100976,64516},{757,100984,64532},{1027,100992,64548},{1259,101000,64564},{1021,101008,64580},{718,101016,64596},{753,101024,64612},{716,101032,64628},{751,101040,64644},{1023,101048,64660},{760,101056,64676},{1064,101064,64692},{794,101072,64708},{796,101080,64724},{329,101088,64740},{5,101096,64756},{360,101104,64772},{38,101112,64788},{897,101120,64804},{368,101128,64820},{221,101136,64836},{1115,101144,64852},{828,101152,64868},{366,101160,64884},{1,101168,64900},{1363,101176,64916},{3,101184,64932},{811,101192,64948},{1326,101200,64964},{850,101208,64980},{1361,101216,64996},{1324,101224,65012},{1365,101232,65028},{30,101240,65044},{865,101248,65060},{497,101256,65076},{1231,101264,65092},{321,101272,65108},{1424,101280,65124},{499,101288,65140},{1055,101296,65156},{1422,101304,65172},{930,101312,65188},{1059,101320,65204},{1426,101328,65220},{924,101336,65236},{961,101344,65252},{963,101352,65268},{1469,101360,65284},{77,101368,65300},{1098,101376,65316},{1461,101384,65332},{1111,101392,65348},{163,101400,65364},{126,101408,65380},{539,101416,65396},{576,101424,65412},{1463,101432,65428},{537,101440,65444},{124,101448,65460},{574,101456,65476},{411,101464,65492},{73,101472,65508},{572,101480,65524},{75,101488,65540},{450,101496,65556},{415,101504,65572},{1126,101512,65588},{71,101520,65604},{1467,101528,65620},{169,101536,65636},{413,101544,65652},{697,101552,65668},{1342,101560,65684},{167,101568,65700},{650,101576,65716},{613,101584,65732},{1169,101592,65748},{699,101600,65764},{629,101608,65780},{1128,101616,65796},{662,101624,65812},{1263,101632,65828},{290,101640,65844},{218,101648,65860},{533,101656,65876},{120,101664,65892},{777,101672,65908},{259,101680,65924},{531,101688,65940},{766,101696,65956},{729,101704,65972},{779,101712,65988},{257,101720,66004},{1226,101728,66020},{1032,101736,66036},{764,101744,66052},{1071,101752,66068},{1034,101760,66084},{762,101768,66100},{48,101776,66116},{1401,101784,66132},{1073,101792,66148},{1163,101800,66164},{7,101808,66180},{1167,101816,66196},{1269,101824,66212},{1165,101832,66228},{338,101840,66244},{334,101848,66260},{1318,101856,66276},{1355,101864,66292},{212,101872,66308},{377,101880,66324},{800,101888,66340},{856,101896,66356},{375,101904,66372},{1390,101912,66388},{817,101920,66404},{854,101928,66420},{852,101936,66436},{1143,101944,66452},{1359,101952,66468},{1106,101960,66484},{1398,101968,66500},{44,101976,66516},{1280,101984,66532},{893,101992,66548},{1396,102000,66564},{1282,102008,66580},{1394,102016,66596},{891,102024,66612},{482,102032,66628},{480,102040,66644},{408,102048,66660},{332,102056,66676},{988,102064,66692},{900,102072,66708},{330,102080,66724},{1206,102088,66740},{902,102096,66756},{1247,102104,66772},{1068,102112,66788},{936,102120,66804},{1208,102128,66820},{1433,102136,66836},{1243,102144,66852},{1204,102152,66868},{1437,102160,66884},{932,102168,66900},{1182,102176,66916},{87,102184,66932},{977,102192,66948},{1202,102200,66964},{179,102208,66980},{971,102216,66996},{134,102224,67012},{584,102232,67028},{1180,102240,67044},{1200,102248,67060},{132,102256,67076},{545,102264,67092},{508,102272,67108},{543,102280,67124},{443,102288,67140},{406,102296,67156},{1117,102304,67172},{81,102312,67188},{173,102320,67204},{1476,102328,67220},{171,102336,67236},{688,102344,67252}};
//{606,96816,56196},{641,96824,56212},{175,96832,56228},{1272,96840,56244},{1276,96848,56260},{286,96856,56276},{249,96864,56292},{502,96872,56308},{284,96880,56324},{208,96888,56340},{280,96896,56356},{541,96904,56372},{206,96912,56388},{786,96920,56404},{1237,96928,56420},{1008,96936,56436},{788,96944,56452},{704,96952,56468},{741,96960,56484},{1045,96968,56500},{1235,96976,56516},{738,96984,56532},{706,96992,56548},{1239,97000,56564},{1152,97008,56580},{849,97016,56596},{775,97024,56612},{1004,97032,56628},{1193,97040,56644},{1156,97048,56660},{771,97056,56676},{1191,97064,56692},{200,97072,56708},{380,97080,56724},{1309,97088,56740},{1136,97096,56756},{847,97104,56772},{877,97112,56788},{808,97120,56804},{57,97128,56820},{1132,97136,56836},{1134,97144,56852},{841,97152,56868},{1348,97160,56884},{1346,97168,56900},{10,97176,56916},{1291,97184,56932},{884,97192,56948},{1293,97200,56964},{1385,97208,56980},{300,97216,56996},{473,97224,57012},{1250,97232,57028},{304,97240,57044},{949,97248,57060},{1254,97256,57076},{1217,97264,57092},{1446,97272,57108},{1409,97280,57124},{1256,97288,57140},{947,97296,57156},{1219,97304,57172},{1407,97312,57188},{1215,97320,57204},{1448,97328,57220},{945,97336,57236},{908,97344,57252},{906,97352,57268},{943,97360,57284},{96,97368,57300},{986,97376,57316},{1213,97384,57332},{180,97392,57348},{1211,97400,57364},{141,97408,57380},{591,97416,57396},{558,97424,57412},{108,97432,57428},{519,97440,57444},{556,97448,57460},{432,97456,57476},{1186,97464,57492},{597,97472,57508},{147,97480,57524},{1149,97488,57540},{430,97496,57556},{92,97504,57572},{1147,97512,57588},{182,97520,57604},{145,97528,57620},{631,97536,57636},{1188,97544,57652},{149,97552,57668},{186,97560,57684},{1284,97568,57700},{684,97576,57716},{238,97584,57732},{680,97592,57748},{511,97600,57764},{273,97608,57780},{234,97616,57796},{102,97624,57812},{271,97632,57828},{550,97640,57844},{513,97648,57860},{799,97656,57876},{711,97664,57892},{1019,97672,57908},{1421,97680,57924},{28,97688,57940},{26,97696,57956},{782,97704,57972},{1184,97712,57988},{1015,97720,58004},{1011,97728,58020},{1013,97736,58036},{391,97744,58052},{317,97752,58068},{315,97760,58084},{230,97768,58100},{866,97776,58116},{1332,97784,58132},{834,97792,58148},{20,97800,58164},{22,97808,58180},{1082,97816,58196},{871,97824,58212},{873,97832,58228},{1260,97840,58244},{1379,97848,58260},{1338,97856,58276},{1221,97864,58292},{429,97872,58308},{466,97880,58324},{1084,97888,58340},{1373,97896,58356},{427,97904,58372},{313,97912,58388},{311,97920,58404},{1377,97928,58420},{1225,97936,58436},{921,97944,58452},{1418,97952,58468},{1451,97960,58484},{1049,97968,58500},{1414,97976,58516},{953,97984,58532},{1160,97992,58548},{990,98000,58564},{157,98008,58580},{568,98016,58596},{1457,98024,58612},{1121,98032,58628},{155,98040,58644},{566,98048,58660},{67,98056,58676},{153,98064,58692},{114,98072,58708},{529,98080,58724},{527,98088,58740},{112,98096,58756},{562,98104,58772},{460,98112,58788},{61,98120,58804},{421,98128,58820},{1175,98136,58836},{639,98144,58852},{676,98152,58868},{159,98160,58884},{620,98168,58900},{637,98176,58916},{674,98184,58932},{635,98192,58948},{624,98200,58964},{1313,98208,58980},{1179,98216,58996},{261,98224,59012},{226,98232,59028},{224,98248,59060},{1258,98256,59076},{758,98264,59092},{720,98272,59108},{1026,98280,59124},{523,98288,59140},{1067,98296,59156},{756,98304,59172},{265,98312,59188},{754,98320,59204},{719,98328,59220},{1063,98336,59236},{761,98344,59252},{717,98352,59268},{269,98360,59284},{797,98368,59300},{4,98376,59316},{328,98384,59332},{326,98392,59348},{222,98400,59364},{829,98408,59380},{898,98416,59396},{1114,98424,59412},{369,98432,59428},{220,98440,59444},{827,98448,59460},{367,98456,59476},{1321,98464,59492},{825,98472,59508},{851,98480,59524},{814,98488,59540},{2,98496,59556},{1360,98504,59572},{823,98512,59588},{33,98520,59604},{1093,98528,59620},{1232,98536,59636},{862,98544,59652},{864,98552,59668},{1362,98560,59684},{457,98568,59700},{1230,98576,59716},{1097,98584,59732},{860,98592,59748},{1095,98600,59764},{492,98608,59780},{418,98616,59796},{416,98624,59812},{451,98632,59828},{1056,98640,59844},{1423,98648,59860},{1368,98656,59876},{320,98664,59892},{1234,98672,59908},{929,98680,59924},{498,98688,59940},{1099,98696,59956},{927,98704,59972},{925,98712,59988},{1464,98720,60004},{1468,98728,60020},{129,98736,60036},{960,98744,60052},{1110,98752,60068},{164,98760,60084},{577,98768,60100},{76,98776,60116},{538,98784,60132},{575,98792,60148},{160,98800,60164},{573,98808,60180},{70,98816,60196},{412,98824,60212},{1306,98832,60228},{698,98840,60244},{651,98848,60260},{1125,98856,60276},{628,98864,60292},{663,98872,60308},{1300,98880,60324},{1129,98888,60340},{661,98896,60356},{1304,98904,60372},{299,98912,60388},{254,98920,60404},{1266,98928,60420},{1264,98936,60436},{534,98944,60452},{571,98952,60468},{769,98960,60484},{776,98968,60500},{1074,98976,60516},{293,98984,60532},{532,98992,60548},{1406,99000,60564},{291,99008,60580},{1268,99016,60596},{47,99024,60612},{1072,99032,60628},{728,99040,60644},{1035,99048,60660},{1229,99056,60676},{726,99064,60692},{6,99072,60708},{1166,99080,60724},{1400,99088,60740},{374,99096,60756},{339,99104,60772},{337,99112,60788},{801,99120,60804},{1144,99128,60820},{1107,99136,60836},{1356,99144,60852},{857,99152,60868},{1354,99160,60884},{1317,99168,60900},{45,99176,60916},{1142,99184,60932},{805,99192,60948},{1105,99200,60964},{855,99208,60980},{43,99216,60996},{853,99224,61012},{816,99232,61028},{894,99240,61044},{896,99248,61060},{1103,99256,61076},{892,99264,61092},{1391,99272,61108},{1101,99280,61124},{448,99288,61140},{446,99296,61156},{409,99304,61172},{1399,99312,61188},{407,99320,61204},{1434,99328,61220},{1069,99336,61236},{333,99344,61252},{1246,99352,61268},{1395,99368,61300},{331,99376,61316},{989,99384,61332},{901,99392,61348},{1471,99400,61364},{933,99408,61380},{903,99416,61396},{1242,99424,61412},{1203,99432,61428},{489,99440,61444},{1436,99448,61460},{1473,99456,61476},{974,99464,61492},{970,99472,61508},{1475,99480,61524},{583,99488,61540},{133,99496,61556},{548,99504,61572},{581,99512,61588},{546,99520,61604},{84,99528,61620},{1140,99536,61636},{509,99544,61652},{601,99552,61668},{139,99560,61684},{687,99568,61700},{440,99576,61716},{403,99584,61732},{1116,99592,61748},{659,99600,61764},{1331,99608,61780},{642,99616,61796},{607,99624,61812},{657,99632,61828},{176,99640,61844},{1273,99648,61860},{692,99656,61876},{285,99664,61892},{248,99672,61908},{1040,99688,61940},{283,99696,61956},{244,99704,61972},{501,99712,61988},{242,99720,62004},{739,99728,62020},{785,99736,62036},{505,99744,62052},{701,99752,62068},{287,99760,62084},{787,99768,62100},{1279,99776,62116},{58,99784,62132},{1007,99792,62148},{772,99800,62164},{1001,99808,62180},{1151,99816,62196},{50,99824,62212},{1192,99832,62228},{240,99840,62244},{203,99848,62260},{307,99856,62276},{15,99864,62292},{201,99872,62308},{876,99880,62324},{1194,99888,62340},{1345,99896,62356},{1137,99904,62372},{56,99912,62388},{1308,99920,62404},{1133,99928,62420},{1347,99936,62436},{807,99944,62452},{842,99952,62468},{885,99960,62484},{1198,99968,62500},{1388,99976,62516},{1380,99984,62532},{439,99992,62548},{437,100000,62564},{470,100008,62580},{433,100016,62596},{1445,100024,62612},{340,100032,62628},{1255,100040,62644},{1218,100048,62660},{1386,100056,62676},{956,100064,62692},{946,100072,62708},{993,100080,62724},{1212,100088,62740},{944,100096,62756},{995,100104,62772},{97,100112,62788},{1251,100120,62804},{1253,100128,62820},{983,100136,62836},{95,100144,62852},{985,100152,62868},{144,100160,62884},{981,100168,62900},{142,100176,62916},{109,100184,62932},{590,100192,62948},{557,100200,62964},{518,100208,62980},{598,100216,62996},{185,100224,63012},{1148,100232,63028},{630,100240,63044},{183,100248,63060},{648,100256,63076},{632,100264,63092},{189,100272,63108},{634,100280,63124},{646,100288,63140},{1189,100296,63156},{1090,100304,63172},{609,100312,63188},{683,100320,63204},{685,100328,63220},{1283,100336,63236},{1051,100344,63252},{235,100352,63268},{512,100360,63284},{272,100368,63300},{1285,100376,63316},{101,100384,63332},{551,100392,63348},{710,100400,63364},{748,100408,63380},{278,100416,63396},{239,100424,63412},{712,100432,63428},{709,100440,63444},{1287,100448,63460},{25,100456,63476},{744,100464,63492},{707,100472,63508},{1016,100480,63524},{1185,100488,63540},{1012,100496,63556},{783,100504,63572},{396,100512,63588},{318,100520,63604},{355,100528,63620},{27,100536,63636},{1333,100544,63652},{23,100552,63668},{1337,100560,63684},{822,100568,63700},{1370,100576,63716},{1335,100584,63732},{872,100592,63748},{1374,100600,63764},{1085,100608,63780},{870,100616,63796},{469,100624,63812},{467,100632,63828},{351,100640,63844},{919,100648,63860},{1413,100656,63876},{920,100664,63892},{1450,100672,63908},{969,100680,63924},{1415,100688,63940},{999,100696,63956},{952,100704,63972},{954,100712,63988},{117,100720,64004},{567,100728,64020},{1120,100736,64036},{154,100744,64052},{950,100752,64068},{115,100760,64084},{1454,100768,64100},{1419,100776,64116},{152,100784,64132},{528,100792,64148},{563,100800,64164},{113,100808,64180},{111,100816,64196},{561,100824,64212},{62,100832,64228},{424,100840,64244},{461,100848,64260},{1351,100856,64276},{621,100864,64292},{677,100872,64308},{158,100880,64324},{1316,100888,64340},{1353,100896,64356},{569,100904,64372},{660,100912,64388},{199,100920,64404},{1312,100928,64420},{636,100936,64436},{1176,100944,64452},{1310,100952,64468},{262,100960,64484},{520,100968,64500},{260,100976,64516},{757,100984,64532},{1027,100992,64548},{1259,101000,64564},{1021,101008,64580},{718,101016,64596},{753,101024,64612},{716,101032,64628},{751,101040,64644},{1023,101048,64660},{760,101056,64676},{1064,101064,64692},{794,101072,64708},{796,101080,64724},{329,101088,64740},{5,101096,64756},{360,101104,64772},{38,101112,64788},{897,101120,64804},{368,101128,64820},{221,101136,64836},{1115,101144,64852},{828,101152,64868},{366,101160,64884},{1,101168,64900},{1363,101176,64916},{3,101184,64932},{811,101192,64948},{1326,101200,64964},{850,101208,64980},{1361,101216,64996},{1324,101224,65012},{1365,101232,65028},{30,101240,65044},{865,101248,65060},{497,101256,65076},{1231,101264,65092},{321,101272,65108},{1424,101280,65124},{499,101288,65140},{1055,101296,65156},{1422,101304,65172},{930,101312,65188},{1059,101320,65204},{1426,101328,65220},{924,101336,65236},{961,101344,65252},{963,101352,65268},{1469,101360,65284},{77,101368,65300},{1098,101376,65316},{1461,101384,65332},{1111,101392,65348},{163,101400,65364},{126,101408,65380},{539,101416,65396},{576,101424,65412},{1463,101432,65428},{537,101440,65444},{124,101448,65460},{574,101456,65476},{411,101464,65492},{73,101472,65508},{572,101480,65524},{75,101488,65540},{450,101496,65556},{415,101504,65572},{1126,101512,65588},{71,101520,65604},{1467,101528,65620},{169,101536,65636},{413,101544,65652},{697,101552,65668},{1342,101560,65684},{167,101568,65700},{650,101576,65716},{613,101584,65732},{1169,101592,65748},{699,101600,65764},{629,101608,65780},{1128,101616,65796},{662,101624,65812},{1263,101632,65828},{290,101640,65844},{218,101648,65860},{533,101656,65876},{120,101664,65892},{777,101672,65908},{259,101680,65924},{531,101688,65940},{766,101696,65956},{729,101704,65972},{779,101712,65988},{257,101720,66004},{1226,101728,66020},{1032,101736,66036},{764,101744,66052},{1071,101752,66068},{1034,101760,66084},{762,101768,66100},{48,101776,66116},{1401,101784,66132},{1073,101792,66148},{1163,101800,66164},{7,101808,66180},{1167,101816,66196},{1269,101824,66212},{1165,101832,66228},{338,101840,66244},{334,101848,66260},{1318,101856,66276},{1355,101864,66292},{212,101872,66308},{377,101880,66324},{800,101888,66340},{856,101896,66356},{375,101904,66372},{1390,101912,66388},{817,101920,66404},{854,101928,66420},{852,101936,66436},{1143,101944,66452},{1359,101952,66468},{1106,101960,66484},{1398,101968,66500},{44,101976,66516},{1280,101984,66532},{893,101992,66548},{1396,102000,66564},{1282,102008,66580},{1394,102016,66596},{891,102024,66612},{482,102032,66628},{480,102040,66644},{408,102048,66660},{332,102056,66676},{988,102064,66692},{900,102072,66708},{330,102080,66724},{1206,102088,66740},{902,102096,66756},{1247,102104,66772},{1068,102112,66788},{936,102120,66804},{1208,102128,66820},{1433,102136,66836},{1243,102144,66852},{1204,102152,66868},{1437,102160,66884},{932,102168,66900},{1182,102176,66916},{87,102184,66932},{977,102192,66948},{1202,102200,66964},{179,102208,66980},{971,102216,66996},{134,102224,67012},{584,102232,67028},{1180,102240,67044},{1200,102248,67060},{132,102256,67076},{545,102264,67092},{508,102272,67108},{543,102280,67124},{443,102288,67140},{406,102296,67156},{1117,102304,67172},{81,102312,67188},{173,102320,67204},{1476,102328,67220},{171,102336,67236},{688,102344,67252},

#define errquit(m)	{ perror(m); _exit(-1); }
static long main_min = 0, main_max = 0;
static long got_min = 0, got_max = 0;
static void get_base() {
	int fd, sz;
	char buf[16384], *s = buf, *line, *saveptr;
	if(got_max != 0) return;
	if((fd = open("/proc/self/maps", O_RDONLY)) < 0) errquit("get_base/open");
	if((sz = read(fd, buf, sizeof(buf)-1)) < 0) errquit("get_base/read");
	buf[sz] = 0;
	close(fd);
	while((line = strtok_r(s, "\n\r", &saveptr)) != NULL) { s = NULL;
//		if(strstr(line, " r-xp ") == NULL) continue;
		if(strstr(line, "/chal") != NULL && !main_min && !main_max) {
			if(sscanf(line, "%lx-%lx ", &main_min, &main_max) != 2) errquit("get_base/main");
		}
        if(main_min && main_max){
            long lb,ub;
            sscanf(line, "%lx-%lx ",&lb,&ub);
            long cur_got=main_min+func[0][1];
            if(lb<=cur_got && cur_got<=ub){
                got_min=lb;
                got_max=ub;
                fprintf(stderr,"(%lx,%lx) <= %lx\n",lb,cur_got,ub);
            }
        }
		if(main_min!=0 && main_max!=0 && got_min!=0 && got_max!=0) return;
	}
    return;
	_exit(-fprintf(stderr, "** get_base failed.\n"));
}

int cmp(int a[3],int b[3]){
    return a[0]-b[0];
}

int init(){
    get_base();
    printf("%lx %lx %lx %lx\n",main_min,main_max,got_min,got_max);
    printf("%lx~%lx %lx %lx\n",got_min,got_max,got_max-got_min,0);

    if(mprotect((void*)got_min,got_max-got_min,PROT_READ|PROT_WRITE|PROT_EXEC)==-1){
        perror("mprotect");
        exit(1);
    }

    void*fhandle;
    fhandle=dlopen("./libpoem.so",RTLD_LAZY);
    if(!fhandle){
        fprintf(stderr,"%s\n",dlerror());
        exit(1);
    }

    int nlen=sizeof(ndat)/sizeof(ndat[0]);
    int len=sizeof(func)/sizeof(func[0]);
    fprintf(stderr,"\n");
    for(int i=0;i<nlen;++i){
        int vic=ndat[i];
        int src=-1;
        for(int j=0;j<len;++j){
            if(func[j][0]==vic){
                src=j;
            }
        }
        if(src==-1){
            fprintf(stderr,"Cannot found code_%d for i=%d ndat[i]=%d\n",vic,i,vic);
            continue;
        }
        // func[src][0]==vic
        fprintf(stderr,"i=%d src=%d ndat[i]=vic=%d\n",i,src,vic);
        unsigned long*addr=((void*)main_min+func[src][1]);
        fprintf(stderr,"code_%d addr=%p faddr=%p\n",vic,addr,*addr);
        char fname[10];
        sprintf((int*)fname,"code_%d",i);
        unsigned long target;
        if((target=dlsym(fhandle,fname))==0){
            perror("dlsym");
            exit(1);
        }
        *addr=target;
        fprintf(stderr,"code_%d addr=%p tar=%p\n",vic,addr,target);
        fprintf(stderr,"code_%d addr=%p faddr=%p\n",vic,addr,*addr);
    }
    return 0;
}


